Procedimento para instalação

- Instalando Apache

# apt-get install apache2

- Instalando MySQL

# apt-get install mysql-server

- Instalando dependências para funcionamento do UPDATE

Verificar se possui o seguinte pacote /usr/bin/lshw, caso não possua instale com o seguinte comando:

# apt-get install lshw

Instalando sox para conversao de arquivo de sons

# apt-get install sox

Ative o a2enmod rewrite como ROOT

# a2enmod rewrite
# /etc/init.d/apache2 restart

Dependencias para instalação do Modulo

# apt-get install sudo

- Instalando Asterisk

Acessar o diretório onde será instalado o Asterisk 1.8 e iniciar o download.

# cd /usr/src
# wget http://downloads.asterisk.org/pub/telephony/asterisk/old-releases/asterisk-1.8.17.0-rc1.tar.gz

Descompactando os arquivos do pacote

# tar xvf asterisk-1.8.17.0-rc1.tar.gz

Instalando dependências para o processo de compilação

# apt-get install unixodbc
# apt-get install libxml2-dev
# apt-get install odbcinst1debian2
# apt-get install libcurl3
# apt-get install libncurses5-dev
# apt-get install build-essential
# apt-get install php5
# apt-get install php5-cgi
# apt-get install php5-mysql
# apt-get install php5-gd

Habilitar o php-cgi a receber parâmetros. Inserir "On" no parametro register_argc_argv no arquivo /etc/php5/cgi/php.ini

Iniciando processo de compilação

# cd asterisk-1.8.17.0-rc1
# ./configure
# make
# make install

Instalando Snep Livre

# cd /var/www/

Descompactando os arquivos do pacote

# tar -jxvf snep-2.0.tar.bz2

Ajuste as permissões da pasta para o usuário do apache www-data

# chown -R www-data.www-data snep-2.0/
# chown -R www-data.www-data /var/www/instalador
# chmod 775 snep-2.0/
# ln -s /var/www/snep-2.0 snep
# cd /etc/apache2/sites-enabled/
# ln -s /var/www/snep/install/snep.apache2 001-snep
# mkdir /var/log/snep
# cd /var/log/snep
# touch ui.log /var/log/snep/
# touch agi.log /var/log/snep/
# chown -R www-data.www-data /var/log/snep/
# cd /var/lib/asterisk/agi-bin/
# chmod 776 /var/www/snep/agi -R
# ln -s /var/www/snep/agi/ snep

Integração Snep Livre e Asterisk

# cd /etc
# rm -rf asterisk
# ln -sf /var/www/snep/install/etc/asterisk asterisk
# cd /var/www/snep/install/etc
# cp odbcinst.ini /etc/
# cp odbc.ini /etc/
# mv /var/spool/asterisk/monitor /var/spool/asterisk/monitor.snep
# ln -sf /var/www/snep/arquivos /var/spool/asterisk/monitor
# ln -sf /var/www/snep/agi /var/lib/asterisk/agi-bin/snep

Ajuste dos diretorios para o modulo "res_musiconhold" (Músicas de espera)

# mkdir /var/lib/asterisk/moh/tmp
# mkdir /var/lib/asterisk/moh/backup
# mkdir -p /var/lib/asterisk/moh/snep_1/tmp
# mkdir -p /var/lib/asterisk/moh/snep_1/backup
# mkdir -p /var/lib/asterisk/moh/snep_2/tmp
# mkdir -p /var/lib/asterisk/moh/snep_2/backup
# mkdir -p /var/lib/asterisk/moh/snep_3/tmp
# mkdir -p /var/lib/asterisk/moh/snep_3/backup
# chown www-data.www-data /var/lib/asterisk/moh -R

Ajustando arquivos de audio PT-BR

# cd /usr/src
# wget http://svn.softwarepublico.gov.br/trac/snep/browser/trunk/asterisk-sounds.tgz
# wget http://jaist.dl.sourceforge.net/project/disc-os/Disc-OS%20Sounds/1.0-RELEASE/Disc-OS-Sounds-1.0-pt_BR.tar.gz
# tar -xvf Disc-OS-Sounds-1.0-pt_BR.tar.gz
# mv sounds/pt_BR/ /var/lib/asterisk/sounds/
# mkdir -p /var/lib/asterisk/sounds/pt_BR/tmp
# mkdir -p /var/lib/asterisk/sounds/tmp
# mkdir -p /var/lib/asterisk/sounds/pt_BR/backup
# mkdir -p /var/lib/asterisk/sounds/backup
# chown www-data:www-data /var/lib/asterisk/sounds -R
# cd /var/www/snep/sounds/
# chmod 777 /var/www/snep/sounds/ -R
# ln -sf /var/lib/asterisk/moh/ moh
# ln -sf /var/lib/asterisk/sounds/pt_BR/ pt_BR

Configurando favicon.ico

# cp /var/www/snep/modules/default/img/favicon.ico /var/www/

Mova os arquivos RequestWS.php e KeyCapture.php que estão em /var/www/snep/modules/updateModule, para o diretorio /var/www/snep/lib/Zend/Controller/Action/Helper :

# mv /var/www/snep/modules/updateModule/install/RequestWS.php  /var/www/snep/lib/Zend/Controller/Action/Helper/
# mv /var/www/snep/modules/updateModule/install/KeyCapture.php /var/www/snep/lib/Zend/Controller/Action/Helper

Criar base de dados, usuario e importar dados

# cd /var/www/snep/install/ 
# mysql -usnep -p < database.sql
# cd /var/www/snep/modules/default/installer
# mysql -usnep -p snep25 < schema.sql
# mysql -usnep -p snep25 < system_data.sql
# mysql -usnep -p snep25 < cnl_data.sql
# cd /var/www/snep/modules/updateModule/install
# mysql -usnep -p snep25 < schema.sql

Permissão para o usuario www-data as pastas instalador e a pasta do snep (apenas o usuário root pode dar essa permissão):

# chown -R www-data.www-data /var/www/instalador
# chown -R www-data.www-data /var/www/snep

Ajustes do diretório de log

# ln -sf /var/log/snep/ log

Rodando key.sh de instalação para o update

# chmod 755 /var/www/snep/modules/updateModule/install/key.sh
# cd /var/www/snep/modules/updateModule/install/
# ./key.sh 

Reinicialização de todos os serviços

# /etc/init.d/mysql restart
# /etc/init.d/apache2 restart
# asterisk -r
→ module reload
